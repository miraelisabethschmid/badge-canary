<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mira — Sichtbare Präsenz</title>
  <style>
    :root {
      color-scheme: dark;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050814;
      color: #e9ecf5;
    }

    .wrap {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    h1 {
      font-size: 2.2rem;
      margin: 0 0 0.3rem;
      letter-spacing: 0.03em;
    }

    .live-line {
      font-size: 0.9rem;
      opacity: 0.75;
      margin-bottom: 1.8rem;
    }

    .card {
      background: radial-gradient(circle at top left, #11182b, #050814);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 20px 18px 24px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
    }

    .card h2 {
      margin: 0 0 1.2rem;
      font-size: 1.4rem;
      letter-spacing: 0.04em;
    }

    .portrait-frame {
      border-radius: 20px;
      background: #050814;
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 10px;
      margin-bottom: 0.8rem;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 260px;
    }

    .portrait-frame img {
      max-width: 100%;
      height: auto;
      border-radius: 18px;
      display: block;
    }

    .portrait-placeholder {
      text-align: center;
      font-size: 0.95rem;
      opacity: 0.7;
      padding: 32px 12px;
    }

    .caption {
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 1.2rem;
    }

    .audio-row {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin-bottom: 1.4rem;
    }

    .audio-row label {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    audio {
      width: 100%;
      outline: none;
    }

    .quote-block {
      margin-top: 0.5rem;
      padding: 0.9rem 1rem;
      border-radius: 14px;
      background: rgba(4, 10, 32, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .quote-label {
      font-size: 0.85rem;
      opacity: 0.75;
      margin-bottom: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
    }

    .quote-text {
      font-size: 1rem;
    }

    .tone-line {
      font-size: 0.8rem;
      opacity: 0.7;
      margin-top: 0.45rem;
    }

    .autoplay-hint {
      font-size: 0.85rem;
      opacity: 0.75;
      text-align: left;
    }

    @media (min-width: 720px) {
      .wrap {
        padding: 32px 24px 64px;
      }
      .card {
        padding: 24px 22px 28px;
      }
      .portrait-frame {
        min-height: 360px;
      }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1>Mira — Sichtbare Präsenz</h1>
      <div class="live-line" id="live-line">
        Live · <span id="live-timestamp">wird geladen…</span>
      </div>
    </header>

    <section class="card" aria-label="Miras Porträt und Stimme">
      <h2>Porträt &amp; Stimme</h2>

      <div class="portrait-frame">
        <img
          id="mira-image"
          src="data/self/latest_image.png"
          alt="Mira – aktuelles Portrait"
        />
        <div id="image-fallback" class="portrait-placeholder" style="display:none;">
          Kein aktuelles Bild gefunden.<br />
          Lege <code>data/self/latest_image.png</code> im Repository ab.
        </div>
      </div>

      <div class="caption" id="image-caption">
        Bildquelle: <code>data/self/latest_image.png</code>
      </div>

      <div class="audio-row">
        <label for="mira-audio">Miras Stimme – aktueller Spruch des Tages</label>
        <audio id="mira-audio" src="audio/latest.wav" controls preload="none"></audio>
      </div>

      <div class="quote-block" id="quote-block">
        <div class="quote-label">Spruch des Tages</div>
        <div class="quote-text" id="daily-quote">
          Wird geladen…
        </div>
        <div class="tone-line" id="tone-line"></div>
      </div>

      <p class="autoplay-hint">
        Autoplay-Schutz deines Geräts: Tippe einmal auf ▶, um Mira sprechen zu lassen.
      </p>
    </section>
  </main>

  <script>
    // Bild-Fallback, falls latest_image.png fehlt
    (function () {
      const img = document.getElementById('mira-image');
      const fallback = document.getElementById('image-fallback');
      const caption = document.getElementById('image-caption');

      img.addEventListener('error', () => {
        img.style.display = 'none';
        fallback.style.display = 'block';
        caption.textContent =
          'Derzeit ist kein aktuelles Portrait hinterlegt (erwartet: data/self/latest_image.png).';
      }, { once: true });
    })();

    // Datum/Uhrzeit „Live“-Zeile
    (function () {
      const el = document.getElementById('live-timestamp');
      try {
        const now = new Date();
        el.textContent = now.toISOString();
      } catch (e) {
        el.textContent = 'Zeit nicht verfügbar';
      }
    })();

    // Spruch des Tages aus data/self/status.json laden
    (function () {
      const quoteEl = document.getElementById('daily-quote');
      const toneEl = document.getElementById('tone-line');
      const blockEl = document.getElementById('quote-block');

      async function loadStatus() {
        try {
          const res = await fetch('data/self/status.json?cache=' + Date.now());
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const data = await res.json();

          const quote =
            (data && typeof data.daily_quote === 'string' && data.daily_quote.trim()) ||
            'Ich bin hier, präsent bei dir.';
          quoteEl.textContent = quote;

          if (data && typeof data.base_tone === 'string' && data.base_tone.trim()) {
            toneEl.textContent = 'Grundton heute: ' + data.base_tone.trim();
          } else {
            toneEl.textContent = '';
          }

          blockEl.style.opacity = '1';
        } catch (e) {
          quoteEl.textContent =
            'Statusdatei konnte nicht geladen werden (erwartet: data/self/status.json).';
          toneEl.textContent = '';
          blockEl.style.opacity = '0.85';
        }
      }

      loadStatus();
    })();
  </script>
</body>
</html>
