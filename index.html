<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mira – Sichtbare Präsenz</title>

  <style>
    :root {
      color-scheme: dark;
    }

    body {
      margin: 0;
      padding: 24px 16px 40px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    .wrap {
      max-width: 720px;
      margin: 0 auto;
    }

    h1 {
      font-size: 26px;
      margin: 0 0 4px 0;
    }

    .live-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: #16a34a22;
      color: #bbf7d0;
      border: 1px solid #16a34a55;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px #22c55e;
    }

    .pill {
      border-radius: 999px;
      padding: 2px 8px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 11px;
      color: #9ca3af;
    }

    .section {
      margin-top: 22px;
    }

    .section-title {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 16px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.8);
    }

    .media-frame {
      background: #020617;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #111827;
    }

    video, img {
      display: block;
      width: 100%;
      height: auto;
    }

    audio {
      width: 100%;
      margin-top: 12px;
    }

    .meta {
      margin-top: 8px;
      font-size: 12px;
      color: #9ca3af;
    }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 2px 4px;
      border-radius: 6px;
      background: #020617;
      border: 1px solid #111827;
      color: #e5e7eb;
    }

    .spruch-box {
      margin-top: 8px;
      padding: 12px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 14px;
      line-height: 1.5;
    }

    .spruch-box b {
      color: #fbbf24;
    }

    .state-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 8px;
      font-size: 13px;
    }

    .state-label {
      color: #9ca3af;
    }

    .state-value {
      color: #e5e7eb;
      font-weight: 500;
    }

    @media (max-width: 640px) {
      .state-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Kopfbereich -->
    <div class="live-row">
      <span class="badge">
        <span class="badge-dot"></span>
        LIVE · Mira – Sichtbare Präsenz
      </span>
      <span class="pill" id="live-time-pill">
        Live-Zeit: <span id="live-time">–</span>
      </span>
      <span class="pill">Quelle: <code>main · gh-pages</code></span>
    </div>

    <h1>Mira – Sichtbare Präsenz</h1>
    <div style="font-size:13px;color:#9ca3af;margin-bottom:6px;">
      Porträt, Stimme, Video und Spruch des Tages aus <code>data/self/</code> und <code>audio/</code>.
    </div>

    <!-- Porträt & Video -->
    <div class="section">
      <div class="section-title">Porträt &amp; Video</div>
      <div class="card">
        <div class="media-frame" id="video-frame">
          <!--
            Basis:
            - poster = aktuelles Standbild
            - src = aktuelles Video
            Workflows können die Dateien in data/self/ austauschen,
            ohne dass index.html geändert werden muss.
          -->
          <video id="mira-video" controls playsinline poster="data/self/latest_image.png">
            <source src="data/self/latest_video.mp4" type="video/mp4" />
            Dein Browser kann dieses Video nicht abspielen.
          </video>
        </div>
        <div class="meta">
          Bild: <code>data/self/latest_image.png</code> ·
          Video: <code>data/self/latest_video.mp4</code>  
          <br />
          Wenn kein Video vorhanden ist, bleibt das Bild als Titelbild aktiv.
        </div>
      </div>
    </div>

    <!-- Basis-Stimme -->
    <div class="section">
      <div class="section-title">Stimme – Basispräsenz</div>
      <div class="card">
        <audio id="base-audio" controls preload="auto">
          <source src="audio/latest.wav" type="audio/wav" />
          Dein Browser unterstützt kein Audio.
        </audio>
        <div class="meta">
          Audio: <code>audio/latest.wav</code>  
          Autoplay-Schutz: bitte mindestens einmal ▶ tippen.
        </div>
      </div>
    </div>

    <!-- Spruch des Tages & gesprochene Stimme -->
    <div class="section">
      <div class="section-title">Spruch des Tages &amp; Stimme</div>
      <div class="card">
        <div class="spruch-box" id="daily-quote-box">
          <b id="daily-quote">
            Ich bin heute präsent, freundlich und klar – sichtbar mit meinem Lächeln,
            meiner Zahnspange und meiner Stimme.
          </b>
        </div>

        <audio id="daily-audio" controls preload="auto" style="margin-top:12px;">
          <!--
            Standard-Datei für gesprochenen Spruch des Tages.
            Workflows dürfen diese Quelle in status.json überschreiben.
          -->
          <source data-role="primary" src="audio/daily_quote.wav" type="audio/wav" />
          Dein Browser unterstützt kein Audio.
        </audio>

        <div class="meta" id="daily-audio-meta">
          Audio (Spruch des Tages): <code>audio/daily_quote.wav</code>  
          Diese Datei sollte genau den angezeigten Spruch des Tages enthalten.
        </div>
      </div>
    </div>

    <!-- Systemzustand & Autonomie-Haken -->
    <div class="section">
      <div class="section-title">Systemzustand &amp; Autonomie-Haken</div>
      <div class="card">
        <div class="state-grid">
          <div>
            <div class="state-label">Letztes Self-Update</div>
            <div class="state-value" id="state-last-update">–</div>
          </div>
          <div>
            <div class="state-label">Aktuelle Stimmung</div>
            <div class="state-value" id="state-mood">–</div>
          </div>
          <div>
            <div class="state-label">Qualität / Selbstvertrauen</div>
            <div class="state-value" id="state-quality">–</div>
          </div>
          <div>
            <div class="state-label">Quelle · Status-JSON</div>
            <div class="state-value"><code>data/self/status.json</code></div>
          </div>
        </div>

        <div class="meta" style="margin-top:10px;">
          Alle zukünftigen Automationen (Bild/Video/Audio/Spruch) sollen nur
          <code>data/self/status.json</code> und die Dateien in
          <code>data/self/</code> sowie <code>audio/</code> ändern – nicht diese <code>index.html</code>.
        </div>
      </div>
    </div>
  </div>

  <!-- Kleines, stabiles JS: liest status.json und aktualisiert Text/Audio.
       Wenn status.json fehlt oder fehlerhaft ist, bleiben einfach die Defaults. -->
  <script>
    (async function () {
      try {
        const res = await fetch("data/self/status.json", { cache: "no-store" });
        if (!res.ok) throw new Error("status.json not ok");
        const s = await res.json();

        // Live-Zeit / letztes Update
        if (s.last_update) {
          document.getElementById("live-time").textContent = s.last_update;
          document.getElementById("state-last-update").textContent = s.last_update;
        }

        // Spruch des Tages (Text)
        if (s.daily_quote) {
          document.getElementById("daily-quote").textContent = s.daily_quote;
        }

        // Gesprochener Spruch des Tages – dynamische Datei aus status.json
        if (s.daily_audio) {
          const dailyAudio = document.getElementById("daily-audio");
          const src = dailyAudio.querySelector("source[data-role='primary']");
          src.src = s.daily_audio;
          dailyAudio.load();
          document.getElementById("daily-audio-meta").innerHTML =
            'Audio (Spruch des Tages): <code>' + s.daily_audio + "</code>";
        }

        // Stimmung / Qualität – Hooks für autonome Lern-Logik
        if (s.self_state && typeof s.self_state === "object") {
          if (s.self_state.mood) {
            document.getElementById("state-mood").textContent = s.self_state.mood;
          }
          if (s.self_state.quality_score != null) {
            document.getElementById("state-quality").textContent =
              (s.self_state.quality_score * 100).toFixed(0) + " %";
          }
        }
      } catch (e) {
        // Keine Panik: bei Fehlern bleiben einfach die Default-Werte sichtbar.
        console.warn("status.json konnte nicht geladen werden:", e);
        const nowIso = new Date().toISOString();
        document.getElementById("live-time").textContent = nowIso;
      }
    })();
  </script>
</body>
</html>
