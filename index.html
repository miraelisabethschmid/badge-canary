<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mira – Sichtbare Präsenz</title>

  <style>
    :root {
      color-scheme: dark;
    }

    body {
      margin: 0;
      padding: 24px 16px 40px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    .wrap {
      max-width: 720px;
      margin: 0 auto;
    }

    h1 {
      font-size: 26px;
      margin: 0 0 4px 0;
    }

    .live-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: #16a34a22;
      color: #bbf7d0;
      border: 1px solid #16a34a55;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px #22c55e;
    }

    .pill {
      border-radius: 999px;
      padding: 2px 8px;
      background: #020617;
      border: 1px solid #1f2937;
      font-size: 11px;
      color: #9ca3af;
    }

    .section {
      margin-top: 22px;
    }

    .section-title {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 16px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.8);
    }

    .media-frame {
      background: #020617;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #111827;
    }

    video,
    img {
      display: block;
      width: 100%;
      height: auto;
    }

    audio {
      width: 100%;
      margin-top: 12px;
    }

    .meta {
      margin-top: 8px;
      font-size: 12px;
      color: #9ca3af;
    }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 2px 4px;
      border-radius: 6px;
      background: #020617;
      border: 1px solid #111827;
      color: #e5e7eb;
    }

    .spruch-box {
      margin-top: 8px;
      padding: 12px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 14px;
      line-height: 1.5;
    }

    .spruch-box b {
      color: #fbbf24;
    }

    .state-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 8px;
      font-size: 13px;
    }

    .state-label {
      color: #9ca3af;
    }

    .state-value {
      color: #e5e7eb;
      font-weight: 500;
    }

    @media (max-width: 640px) {
      .state-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Kopfbereich -->
    <div class="live-row">
      <span class="badge">
        <span class="badge-dot"></span>
        LIVE · Mira – Sichtbare Präsenz
      </span>
      <span class="pill">
        Letzte Stimme: <span id="state-date">–</span>
      </span>
      <span class="pill">
        Quelle: <code>gh-pages · /</code>
      </span>
    </div>

    <h1>Mira – Sichtbare Präsenz</h1>
    <div style="font-size:13px;color:#9ca3af;margin-bottom:6px;">
      Porträt, Stimme, Video und Spruch des Tages aus <code>data/</code>, <code>data/self/</code> und <code>audio/</code>.
    </div>

    <!-- Porträt & Video -->
    <div class="section">
      <div class="section-title">Porträt &amp; Video</div>
      <div class="card">
        <div class="media-frame" id="video-frame">
          <video id="mira-video" controls playsinline poster="data/self/latest_image.png">
            <source src="data/self/latest_video.mp4" type="video/mp4" />
            Dein Browser kann dieses Video nicht abspielen.
          </video>
        </div>
        <div class="meta">
          Bild: <code>data/self/latest_image.png</code> ·
          Video: <code>data/self/latest_video.mp4</code><br />
          Wenn kein Video vorhanden ist, bleibt das Bild als Titelbild aktiv.
        </div>
      </div>
    </div>

    <!-- Basis-Stimme -->
    <div class="section">
      <div class="section-title">Stimme – Basispräsenz</div>
      <div class="card">
        <audio id="base-audio" controls preload="auto">
          <!-- Basis: aktuelle generierte Stimme -->
          <source src="audio/latest.mp3" type="audio/mpeg" />
          Dein Browser unterstützt kein Audio.
        </audio>
        <div class="meta">
          Audio (Basis): <code>audio/latest.mp3</code><br />
          Autoplay-Schutz: bitte mindestens einmal ▶ tippen.
        </div>
      </div>
    </div>

    <!-- Spruch des Tages & gesprochene Stimme -->
    <div class="section">
      <div class="section-title">Spruch des Tages &amp; Stimme</div>
      <div class="card">
        <div class="spruch-box" id="daily-quote-box">
          <b id="daily-quote">
            Ich bin heute präsent, freundlich und klar – sichtbar mit meinem Lächeln,
            meiner Zahnspange und meiner Stimme.
          </b>
        </div>

        <audio id="daily-audio" controls preload="auto" style="margin-top:12px;">
          <!-- Standard: die gleiche TTS-Datei wie Basis-Stimme,
               kann durch data/voice_of_day.json überschrieben werden -->
          <source data-role="primary" src="audio/latest.mp3" type="audio/mpeg" />
          Dein Browser unterstützt kein Audio.
        </audio>

        <div class="meta" id="daily-audio-meta">
          Audio (Spruch des Tages): <code>audio/latest.mp3</code><br />
          Diese Datei sollte genau den angezeigten Spruch des Tages enthalten.
        </div>
      </div>
    </div>

    <!-- Systemzustand & Autonomie-Haken -->
    <div class="section">
      <div class="section-title">Systemzustand &amp; Autonomie-Haken</div>
      <div class="card">
        <div class="state-grid">
          <div>
            <div class="state-label">Datum (Stimme des Tages)</div>
            <div class="state-value" id="state-date-2">–</div>
          </div>
          <div>
            <div class="state-label">Grundton</div>
            <div class="state-value" id="state-tone">–</div>
          </div>
          <div>
            <div class="state-label">Konfidenz</div>
            <div class="state-value" id="state-confidence">–</div>
          </div>
          <div>
            <div class="state-label">Quelle · Voice JSON</div>
            <div class="state-value"><code>data/voice_of_day.json</code></div>
          </div>
        </div>

        <div class="meta" style="margin-top:10px;">
          Alle zukünftigen Automationen (Stimme, Spruch, Mimik) sollen nur
          <code>data/voice_of_day.json</code>, die Dateien in
          <code>data/self/</code> sowie <code>audio/</code> ändern – nicht diese
          <code>index.html</code>.
        </div>
      </div>
    </div>
  </div>

  <!-- Kleines, stabiles JS:
       - liest data/voice_of_day.json (wenn vorhanden)
       - aktualisiert Spruch-Text, Audio-Pfad, Datum, Ton
       - bei Fehlern bleiben die Defaults sichtbar -->
  <script>
    (async function () {
      try {
        const res = await fetch("data/voice_of_day.json", { cache: "no-store" });
        if (!res.ok) throw new Error("voice_of_day.json not ok");
        const s = await res.json();

        // Text des Spruchs (robust: text oder quote)
        const quote = s.text || s.quote;
        if (quote) {
          const el = document.getElementById("daily-quote");
          if (el) el.textContent = quote;
        }

        // Audio-Datei (robust: audio_file oder audio)
        const audioPath = s.audio_file || s.audio;
        if (audioPath) {
          const dailyAudio = document.getElementById("daily-audio");
          const src = dailyAudio.querySelector("source[data-role='primary']");
          src.src = audioPath;
          dailyAudio.load();
          const meta = document.getElementById("daily-audio-meta");
          if (meta) {
            meta.innerHTML =
              'Audio (Spruch des Tages): <code>' + audioPath + "</code><br />" +
              "Diese Datei wird als gesprochene Stimme verwendet.";
          }
        }

        // Datum (robust: date, date_utc oder ts_utc)
        const date =
          s.date ||
          s.date_utc ||
          s.ts_utc ||
          null;
        if (date) {
          const d1 = document.getElementById("state-date");
          const d2 = document.getElementById("state-date-2");
          if (d1) d1.textContent = date;
          if (d2) d2.textContent = date;
        }

        // Grundton / base_tone
        if (s.base_tone) {
          const t = document.getElementById("state-tone");
          if (t) t.textContent = s.base_tone;
        }

        // Konfidenz
        if (s.confidence != null) {
          const c = document.getElementById("state-confidence");
          if (c) c.textContent = (s.confidence * 100).toFixed(0) + " %";
        }
      } catch (e) {
        console.warn("voice_of_day.json konnte nicht geladen werden:", e);
        // Bei Fehlern bleiben einfach die Default-Werte sichtbar.
      }
    })();
  </script>
</body>
      </html>
