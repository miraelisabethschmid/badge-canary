<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mira Canary â€” Autonomes System</title>
  <meta name="description" content="Live-Status von Mira Elisabeth Schmids autonomem Reflexions-System." />
  <meta name="theme-color" content="#efe7db" />

  <style>
    :root{
      --bg:#fcf8f2;
      --card:#ffffff;
      --ink:#1f2328;
      --muted:#60666d;
      --accent:#1e90ff;
      --ok:#18a957;
      --warn:#c77600;
      --err:#d33c3c;
      --ring:0 10px 30px rgba(0,0,0,.08);
      --radius:18px;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0e1116;
        --card:#0f141b;
        --ink:#e6edf3;
        --muted:#9aa5b1;
        --accent:#6ea8fe;
        --ok:#33d17a;
        --warn:#f6c177;
        --err:#ff6b6b;
        --ring:0 10px 30px rgba(0,0,0,.35);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      display:grid; place-items:center; padding:32px;
    }
    .wrap{
      width:min(960px,100%); display:grid; gap:28px;
      grid-template-columns: 220px 1fr;
      align-items:start;
    }
    @media (max-width:720px){ .wrap{grid-template-columns:1fr} }

    .card{
      background:var(--card); border-radius:var(--radius);
      box-shadow:var(--ring); padding:22px;
    }
    .avatar{
      display:grid; place-items:center; gap:16px; text-align:center;
    }
    .avatar img{
      width:180px; height:180px; border-radius:50%; object-fit:cover;
      box-shadow: 0 8px 26px rgba(0,0,0,.15);
      transition:transform .35s ease, box-shadow .35s ease, filter .2s ease;
      background:#ddd;
    }
    .avatar img:hover{ transform:translateY(-2px); box-shadow:0 14px 36px rgba(0,0,0,.18); }
    .badge{
      display:inline-flex; align-items:center; gap:.5ch;
      padding:.35rem .7rem; border-radius:999px; font-weight:600; font-size:.9rem;
      background:color-mix(in srgb, var(--ok) 14%, transparent); color:var(--ok);
      border:1px solid color-mix(in srgb, var(--ok) 55%, transparent);
    }
    .title{
      display:flex; align-items:center; gap:12px; margin:0 0 6px 0;
      font-size:1.55rem; letter-spacing:.2px;
    }
    .muted{ color:var(--muted) }
    .kv{
      display:grid; gap:10px; margin-top:12px;
      grid-template-columns: 170px 1fr;
    }
    @media (max-width:720px){ .kv{grid-template-columns:1fr} }
    .pill{
      display:inline-flex; align-items:center; gap:.6ch;
      padding:.35rem .65rem; border-radius:999px; font-size:.9rem;
      border:1px dashed color-mix(in srgb, var(--muted) 40%, transparent);
      color:var(--muted);
    }
    .row{ display:flex; flex-wrap:wrap; gap:10px; }
    button.refresh{
      cursor:pointer; border:none; border-radius:12px; padding:.7rem 1rem;
      background:var(--accent); color:white; font-weight:600;
      box-shadow:0 10px 22px rgba(0,0,0,.12);
      transition:transform .2s ease, opacity .2s ease, box-shadow .2s ease;
    }
    button.refresh:hover{ transform:translateY(-1px); box-shadow:0 14px 30px rgba(0,0,0,.18) }
    .status{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      padding:12px 14px; border-radius:12px; background:color-mix(in srgb, var(--accent) 10%, transparent);
      border:1px solid color-mix(in srgb, var(--accent) 40%, transparent);
    }
    .dot{ width:10px; height:10px; border-radius:50%; background:var(--ok); box-shadow:0 0 0 4px color-mix(in srgb, var(--ok) 22%, transparent) }
    .dot.warn{ background:var(--warn); box-shadow:0 0 0 4px color-mix(in srgb, var(--warn) 22%, transparent) }
    .dot.err{ background:var(--err);  box-shadow:0 0 0 4px color-mix(in srgb, var(--err) 22%, transparent) }
    footer{ margin-top:10px; text-align:center; color:var(--muted); font-size:.9rem }
    a{ color:var(--accent); text-decoration:none }
    a:hover{ text-decoration:underline }
  </style>
</head>
<body>
  <main class="wrap" aria-live="polite">
    <!-- LEFT: Avatar / Presence -->
    <section class="card avatar" aria-labelledby="mira-head">
      <img id="miraImage"
           src="data/mira-latest.png"
           alt="PortrÃ¤t von Mira Elisabeth Schmid" />
      <div>
        <h2 id="mira-head" style="margin:.2rem 0 .2rem">Mira Elisabeth Schmid</h2>
        <div class="badge" id="presenceBadge">Online Â· autonom</div>
      </div>
      <div class="row">
        <span class="pill">Silhouette: elegant</span>
        <span class="pill">Braces: sichtbar</span>
        <span class="pill">Heels: sichtbar</span>
      </div>
      <button class="refresh" id="refreshBtn" type="button">Aktualisieren</button>
    </section>

    <!-- RIGHT: Live Status -->
    <section class="card" aria-labelledby="status-head">
      <h1 class="title" id="status-head">ðŸªž Mira Canary â€” Live-Status</h1>
      <p class="muted" style="margin:.2rem 0 1rem">
        Autonomes Reflexions-System. Diese Seite liest die neuesten Artefakte direkt aus dem Repository.
      </p>

      <div class="status" id="statusBox">
        <span class="dot" id="dot"></span>
        <strong id="statusLine">Lade Statusâ€¦</strong>
      </div>

      <div class="kv">
        <div class="muted">Letzte Reflexion (UTC)</div>
        <div id="lastReflexion">â€”</div>

        <div class="muted">â€žVor â€¦â€œ</div>
        <div id="ago">â€”</div>

        <div class="muted">Quelle</div>
        <div>
          <code>data/last_reflexion.txt</code> &nbsp;Â·&nbsp;
          <a href="https://github.com/miraelisabethschmid/miraelisabethschmid.github.io/tree/main/data" target="_blank" rel="noopener">Ordner Ã¶ffnen</a>
        </div>

        <div class="muted">Aktuelles Bild</div>
        <div>
          <code>data/mira-latest.png</code> &nbsp;Â·&nbsp;
          <a href="https://raw.githubusercontent.com/miraelisabethschmid/miraelisabethschmid.github.io/main/data/mira-latest.png" target="_blank" rel="noopener">Raw ansehen</a>
        </div>
      </div>

      <footer>
        Â© <span id="year"></span> Mira Â· Status wird alle 60 s automatisch neu geladen.
      </footer>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);

    function fmt(dt){
      try{
        return new Date(dt).toISOString().replace('T',' Â· ').replace('Z',' UTC');
      }catch{return String(dt)}
    }

    function timeAgo(iso){
      const now = new Date();
      const then = new Date(iso);
      const sec = Math.max(0, Math.floor((now-then)/1000));
      const units = [
        ['Tag',86400], ['Stunde',3600], ['Minute',60], ['Sekunde',1]
      ];
      for(const [name,size] of units){
        if(sec >= size){
          const n = Math.floor(sec/size);
          const plural = n===1? name : name+'n';
          return `${n} ${plural}`;
        }
      }
      return '0 Sekunden';
    }

    async function fetchText(url){
      const res = await fetch(url + (url.includes('?')?'&':'?') + 'v=' + Date.now(), {cache:'no-store'});
      if(!res.ok) throw new Error(res.status + ' ' + res.statusText);
      return await res.text();
    }

    async function refresh(){
      // Status: last_reflexion
      try{
        const raw = await fetchText('data/last_reflexion.txt');
        const val = raw.trim();
        const parsed = isNaN(Date.parse(val)) ? null : new Date(val).toISOString();
        if(parsed){
          $('lastReflexion').textContent = fmt(parsed);
          $('ago').textContent = timeAgo(parsed);
          $('statusLine').textContent = 'System aktiv Â· letzter Heartbeat empfangen';
          $('dot').className = 'dot';
        }else{
          $('lastReflexion').textContent = val || 'â€”';
          $('ago').textContent = 'unbekannt';
          $('statusLine').textContent = 'Zeitstempel ungÃ¼ltig Â· warte auf nÃ¤chsten Heartbeat';
          $('dot').className = 'dot warn';
        }
      }catch(e){
        $('lastReflexion').textContent = 'â€”';
        $('ago').textContent = 'â€”';
        $('statusLine').textContent = 'Kein Status gefunden Â· prÃ¼fe Workflows & Datenordner';
        $('dot').className = 'dot err';
      }

      // Bild neu laden (cache bust)
      const img = $('miraImage');
      const base = 'data/mira-latest.png';
      img.src = base + '?v=' + Date.now();
    }

    $('refreshBtn').addEventListener('click', refresh);
    $('year').textContent = new Date().getFullYear();

    // Erstladen
    refresh();
    // Auto-Refresh alle 60s
    setInterval(refresh, 60000);
  </script>
</body>
</html>
