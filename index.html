<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mira – Sichtbare Präsenz</title>

    <style>
      :root {
        color-scheme: dark;
        --bg-main: #020617;
        --bg-card: #020617;
        --accent: #22c55e;
        --accent-soft: rgba(34, 197, 94, 0.12);
        --text-main: #f9fafb;
        --text-soft: #9ca3af;
        --border-subtle: rgba(148, 163, 184, 0.35);
        --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.9);
        --radius-xl: 24px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #020617 0, #000 60%);
        color: var(--text-main);
      }

      .page {
        min-height: 100vh;
        padding: 24px 16px 40px;
        display: flex;
        justify-content: center;
      }

      .shell {
        width: 100%;
        max-width: 900px;
      }

      header {
        margin-bottom: 20px;
      }

      .badge-live {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 4px 10px;
        border-radius: 999px;
        background: #064e3b;
        color: #bbf7d0;
        font-size: 12px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .badge-live-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.22);
      }

      h1 {
        margin: 10px 0 4px;
        font-size: 26px;
        letter-spacing: 0.02em;
      }

      .subtitle {
        font-size: 14px;
        color: var(--text-soft);
      }

      .subtitle code {
        font-size: 13px;
        padding: 2px 6px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.25);
      }

      .version {
        margin-top: 4px;
        font-size: 11px;
        color: #6b7280;
      }

      .card {
        background: linear-gradient(145deg, #020617, #020617);
        border-radius: var(--radius-xl);
        border: 1px solid var(--border-subtle);
        box-shadow: var(--shadow-soft);
        padding: 18px 16px 18px;
        margin-bottom: 18px;
      }

      .card-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .media-frame {
        border-radius: 18px;
        overflow: hidden;
        background: #000;
        border: 1px solid rgba(30, 64, 175, 0.7);
      }

      video {
        display: block;
        width: 100%;
        height: auto;
        max-height: 520px;
        background: #000;
      }

      .status-line {
        margin-top: 10px;
        font-size: 13px;
        color: var(--text-soft);
      }

      .status-line code {
        font-size: 12px;
        background: rgba(15, 23, 42, 0.9);
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.25);
      }

      .audio-frame {
        margin-top: 8px;
        border-radius: 16px;
        padding: 10px 10px 14px;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.5);
      }

      audio {
        width: 100%;
      }

      .quote-text {
        margin: 8px 0 4px;
        font-size: 15px;
        line-height: 1.5;
      }

      .quote-status {
        font-size: 12px;
        color: var(--text-soft);
      }

      .footer-note {
        margin-top: 6px;
        font-size: 12px;
        color: var(--text-soft);
      }

      .footer-note strong {
        color: var(--accent);
      }

      @media (min-width: 768px) {
        .page {
          padding: 32px 24px 48px;
        }

        h1 {
          font-size: 32px;
        }

        .card {
          padding: 20px 20px 22px;
        }
      }
    </style>
  </head>

  <body>
    <div class="page">
      <div class="shell">
        <header>
          <div class="badge-live">
            <span class="badge-live-dot"></span>
            <span id="live-label">Live · <span id="live-timestamp">…</span></span>
          </div>
          <h1>Mira – Sichtbare Präsenz</h1>
          <p class="subtitle">
            Porträt, Stimme, Video und Spruch des Tages aus
            <code>data/self/</code> und <code>audio/</code>.
          </p>
          <p class="version">UI-Version: <code>v2.1-perfect-base</code></p>
        </header>

        <!-- Porträt & Video -->
        <section class="card">
          <div class="card-title">Porträt &amp; Video</div>

          <div class="media-frame">
            <video
              id="mira-video"
              controls
              playsinline
              preload="auto"
              poster="data/self/latest_image.png"
            >
              <source src="data/self/latest_video.mp4" type="video/mp4" />
              <!-- Fallback, falls Video nicht unterstützt wird -->
              <img
                src="data/self/latest_image.png"
                alt="Mira – aktuelles Porträt"
              />
              Dein Browser unterstützt keine eingebetteten Videos.
            </video>
          </div>

          <p class="status-line" id="video-status">
            Aktiv: Video <code>data/self/latest_video.mp4</code> &middot;
            Bild <code>data/self/latest_image.png</code> verfügbar als Fallback.
          </p>
        </section>

        <!-- Stimme & Spruch des Tages -->
        <section class="card">
          <div class="card-title">Spruch des Tages &amp; Stimme</div>

          <div class="audio-frame">
            <audio id="mira-audio" controls preload="auto">
              <source src="audio/latest.wav" type="audio/wav" />
              <source src="audio/latest.mp3" type="audio/mpeg" />
              Dein Browser unterstützt keine eingebetteten Audios.
            </audio>

            <p class="status-line" id="audio-status">
              Audio: <code>audio/latest.wav</code> (primär, WAV-Unterstützung) /
              <code>audio/latest.mp3</code> (Fallback, falls vorhanden).
            </p>

            <p class="quote-text" id="quote-text">
              Spruch des Tages wird geladen …
            </p>
            <p class="quote-status" id="quote-status">
              Diese Audio-Datei sollte genau diesen
              <em>Spruch des Tages</em> enthalten.
            </p>

            <p class="footer-note">
              Autoplay-Schutz: Bitte mindestens einmal
              <strong>▶</strong> tippen, damit der Browser das Abspielen zulässt.
            </p>
          </div>
        </section>
      </div>
    </div>

    <script>
      // Live-Zeitstempel anzeigen
      (function () {
        const tsEl = document.getElementById("live-timestamp");
        if (tsEl) {
          tsEl.textContent = new Date().toISOString();
        }
      })();

      // Spruch des Tages laden:
      // 1. Versuch: data/self/status.json
      // 2. Fallback: status.json im Root
      (function () {
        const quoteEl = document.getElementById("quote-text");
        const statusEl = document.getElementById("quote-status");

        async function loadQuote() {
          const candidates = ["data/self/status.json", "status.json"];
          let data = null;

          for (const url of candidates) {
            try {
              const res = await fetch(url, { cache: "no-store" });
              if (!res.ok) continue;
              const json = await res.json();
              if (json && typeof json.daily_quote === "string") {
                data = json;
                break;
              }
            } catch (e) {
              // still try next candidate
            }
          }

          if (!data) {
            quoteEl.textContent =
              "Kein Spruch des Tages gefunden – bitte Status-Datei prüfen.";
            statusEl.textContent =
              "Es konnte keine gültige status.json geladen werden.";
            return;
          }

          quoteEl.textContent = data.daily_quote;
          if (data.updated_at) {
            statusEl.textContent =
              "Spruch des Tages aus status.json · aktualisiert: " +
              data.updated_at;
          } else {
            statusEl.textContent = "Spruch des Tages aus status.json geladen.";
          }
        }

        loadQuote();
      })();

      // Video-Fallback: wenn Video nicht lädt → Hinweis anpassen
      (function () {
        const video = document.getElementById("mira-video");
        const statusEl = document.getElementById("video-status");
        if (!video || !statusEl) return;

        video.addEventListener("error", function () {
          statusEl.textContent =
            "Video konnte nicht geladen werden – es wird nur das Bild data/self/latest_image.png angezeigt.";
        });

        video.addEventListener("loadeddata", function () {
          statusEl.innerHTML =
            'Aktiv: Video <code>data/self/latest_video.mp4</code> · Bild <code>data/self/latest_image.png</code> verfügbar als Fallback.';
        });
      })();
    </script>
  </body>
</html>
