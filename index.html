<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mira — Sichtbare Präsenz</title>

  <style>
    :root {
      color-scheme: dark;
      --bg-main: #050814;
      --card-bg: #101522;
      --accent: #3ce081;
      --accent-soft: rgba(60, 224, 129, 0.12);
      --text-main: #f5f7ff;
      --text-soft: #a9b2ca;
      --border-subtle: #262c3f;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.65);
      --radius-xl: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0c1224 0, #020308 55%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    main.page {
      max-width: 720px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    h1 {
      font-size: 1.7rem;
      font-weight: 650;
      letter-spacing: 0.02em;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--text-soft);
      margin-bottom: 20px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      padding: 18px 16px 20px;
      border: 1px solid var(--border-subtle);
      margin-bottom: 20px;
    }

    .card h2 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .media-frame {
      background: radial-gradient(circle at top left, #202842, #070a14);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 8px;
      margin-bottom: 10px;
    }

    .media {
      display: block;
      width: 100%;
      max-height: 520px;
      border-radius: 12px;
      object-fit: contain;
      background: #000;
    }

    .status {
      font-size: 0.85rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .status strong {
      color: var(--accent);
      font-weight: 600;
    }

    .audio-wrapper {
      margin-top: 8px;
    }

    audio {
      width: 100%;
      margin: 4px 0;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.75rem;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(60, 224, 129, 0.8);
    }

    @media (min-width: 768px) {
      main.page {
        padding: 32px 24px 48px;
      }
      h1 {
        font-size: 1.9rem;
      }
    }
  </style>
</head>

<body>
  <main class="page">
    <div class="chip">
      <span class="dot"></span>
      Live • Mira – Sichtbare Präsenz
    </div>
    <h1>Mira — Sichtbare Präsenz</h1>
    <p class="subtitle">
      Porträt, Stimme und (wenn möglich) Video aus <code>data/self/</code> und <code>audio/</code>.
    </p>

    <!-- PORTRÄT & VIDEO -->
    <section class="card">
      <h2>Porträt &amp; Video</h2>

      <div class="media-frame">
        <!-- Video: wird per JS aktiviert -->
        <video
          id="miraVideo"
          class="media"
          playsinline
          controls
          preload="metadata"
          poster="data/self/latest_image.png"
        ></video>

        <!-- Fallback-Bild -->
        <img
          id="miraImage"
          class="media"
          src="data/self/latest_image.png"
          alt="Mira – aktuelles Porträt"
          style="display: none;"
        />
      </div>

      <p id="mediaStatus" class="status">
        <strong>Status:</strong> Lade Video&nbsp;…
      </p>
    </section>

    <!-- STIMME -->
    <section class="card">
      <h2>Stimme</h2>

      <div class="audio-wrapper">
        <audio id="miraAudio" controls preload="auto">
          <source src="audio/latest.wav" type="audio/wav" />
          <source src="audio/latest.mp3" type="audio/mpeg" />
          Dein Browser unterstützt das Audio-Element nicht.
        </audio>
      </div>

      <p id="audioStatus" class="status">
        <strong>Status:</strong> Bereit.
      </p>
    </section>
  </main>

  <script>
    (function () {
      // --- Video + Bild Fallback ---
      const video = document.getElementById("miraVideo");
      const image = document.getElementById("miraImage");
      const mediaStatus = document.getElementById("mediaStatus");

      const videoSrc = "data/self/latest_video.mp4";
      let settled = false;

      function showVideo() {
        if (settled) return;
        settled = true;
        image.style.display = "none";
        video.style.display = "block";
        mediaStatus.textContent = "Status: Video geladen – " + videoSrc;
      }

      function showImageFallback(reason) {
        if (settled) return;
        settled = true;

        // Video entkoppeln
        try {
          video.removeAttribute("src");
          video.load();
        } catch (e) {}

        video.style.display = "none";
        image.style.display = "block";
        mediaStatus.textContent =
          "Status: " + (reason || "Video nicht verfügbar, zeige Bild.");
      }

      // Initialzustand: beides verstecken, dann entscheiden
      video.style.display = "none";
      image.style.display = "none";
      mediaStatus.textContent = "Status: Lade Video …";

      video.addEventListener("loadeddata", () => {
        showVideo();
      });

      video.addEventListener("error", () => {
        showImageFallback("Video konnte nicht geladen werden, zeige Bild.");
      });

      // Sicherheits-Timeout: wenn nach 8s nichts passiert, auf Bild gehen
      setTimeout(() => {
        if (!settled) {
          showImageFallback("Video reagiert nicht, zeige Bild.");
        }
      }, 8000);

      // Video-Ladevorgang starten
      try {
        video.src = videoSrc;
        video.load();
      } catch (e) {
        showImageFallback("Fehler beim Initialisieren des Videos, zeige Bild.");
      }

      // --- Audio-Status ---
      const audio = document.getElementById("miraAudio");
      const audioStatus = document.getElementById("audioStatus");

      if (audio) {
        audio.addEventListener("play", () => {
          audioStatus.textContent = "Status: Spielt.";
        });

        audio.addEventListener("pause", () => {
          if (audio.currentTime === 0 || audio.ended) {
            audioStatus.textContent = "Status: Bereit.";
          } else {
            audioStatus.textContent = "Status: Pausiert.";
          }
        });

        audio.addEventListener("ended", () => {
          audioStatus.textContent = "Status: Fertig.";
        });

        audio.addEventListener("error", () => {
          audioStatus.textContent = "Status: Fehler beim Laden der Stimme.";
        });
      }
    })();
  </script>
</body>
</html>
