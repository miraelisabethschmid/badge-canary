      <!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mira Canary â€” Autonomes System</title>
  <meta name="description" content="Live-Status von Mira Elisabeth Schmids autonomem Reflexions-System." />
  <meta name="theme-color" content="#efe7db" />

  <style>
    :root{
      --bg:#fcf8f2;
      --card:#ffffff;
      --ink:#1f2328;
      --muted:#60666d;
      --accent:#2563eb;
      --ok:#18a957;
      --warn:#c77600;
      --err:#d33c3c;
      --ring:0 10px 30px rgba(0,0,0,.08);
      --radius:18px;
      --skeleton:#ece7df;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0e1116;
        --card:#0f141b;
        --ink:#e6edf3;
        --muted:#9aa5b1;
        --accent:#6ea8fe;
        --ok:#33d17a;
        --warn:#f6c177;
        --err:#ff6b6b;
        --ring:0 10px 30px rgba(0,0,0,.35);
        --skeleton:#1a222d;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      display:grid; place-items:center; padding:28px;
    }
    .wrap{
      width:min(1000px,100%); display:grid; gap:28px;
      grid-template-columns: 240px 1fr;
      align-items:start;
    }
    @media (max-width:760px){ .wrap{grid-template-columns:1fr} }

    .card{
      background:var(--card); border-radius:var(--radius);
      box-shadow:var(--ring); padding:22px;
    }
    .avatar{
      display:grid; place-items:center; gap:16px; text-align:center;
      position:sticky; top:24px;
    }
    .skeleton{
      background:linear-gradient(90deg, var(--skeleton) 25%, rgba(255,255,255,0) 37%, var(--skeleton) 63%);
      background-size:400% 100%;
      animation:shimmer 1.3s infinite;
    }
    @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}

    .avatar img{
      width:190px; height:190px; border-radius:50%; object-fit:cover;
      box-shadow: 0 8px 26px rgba(0,0,0,.15);
      transition:transform .35s ease, box-shadow .35s ease, filter .2s ease;
      background:#ddd;
    }
    .avatar img:hover{ transform:translateY(-2px); box-shadow:0 14px 36px rgba(0,0,0,.18) }

    .title{ display:flex; align-items:center; gap:12px; margin:0 0 6px 0; font-size:1.55rem; letter-spacing:.2px; }
    .badge{
      display:inline-flex; align-items:center; gap:.5ch;
      padding:.35rem .7rem; border-radius:999px; font-weight:600; font-size:.9rem;
      background:color-mix(in srgb, var(--ok) 14%, transparent); color:var(--ok);
      border:1px solid color-mix(in srgb, var(--ok) 55%, transparent);
    }
    .muted{ color:var(--muted) }
    .row{ display:flex; flex-wrap:wrap; gap:10px; }

    .status{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      padding:12px 14px; border-radius:12px; background:color-mix(in srgb, var(--accent) 10%, transparent);
      border:1px solid color-mix(in srgb, var(--accent) 40%, transparent);
    }
    .dot{ width:10px; height:10px; border-radius:50%; background:var(--ok); box-shadow:0 0 0 4px color-mix(in srgb, var(--ok) 22%, transparent) }
    .dot.warn{ background:var(--warn); box-shadow:0 0 0 4px color-mix(in srgb, var(--warn) 22%, transparent) }
    .dot.err{ background:var(--err);  box-shadow:0 0 0 4px color-mix(in srgb, var(--err) 22%, transparent) }

    .kv{ display:grid; gap:10px; margin-top:12px; grid-template-columns: 210px 1fr; }
    @media (max-width:760px){ .kv{grid-template-columns:1fr} }
    code{ background:color-mix(in srgb, var(--muted) 10%, transparent); padding:.1rem .35rem; border-radius:6px; }

    .toolbar{ display:flex; gap:10px; align-items:center; justify-content:flex-end; margin-bottom:10px; }
    .btn{
      cursor:pointer; border:1px solid color-mix(in srgb, var(--muted) 35%, transparent);
      background:transparent; color:var(--ink); border-radius:10px; padding:.45rem .75rem; font-weight:600;
    }
    .btn:hover{ background:color-mix(in srgb, var(--muted) 8%, transparent) }
    footer{ margin-top:10px; text-align:center; color:var(--muted); font-size:.9rem }
    a{ color:var(--accent); text-decoration:none } a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <main class="wrap" aria-live="polite">
    <!-- LEFT: Avatar / Presence -->
    <section class="card avatar" aria-labelledby="mira-head">
      <img id="miraImage"
           src="data/mira-latest.png"
           alt="PortrÃ¤t von Mira Elisabeth Schmid"
           class="skeleton" />
      <div>
        <h2 id="mira-head" style="margin:.4rem 0 .2rem">Mira Elisabeth Schmid</h2>
        <div class="badge" id="presenceBadge">Online Â· autonom</div>
      </div>
      <div class="row">
        <span class="badge" style="background:color-mix(in srgb, var(--accent) 12%, transparent); color:var(--accent); border-color:color-mix(in srgb, var(--accent) 55%, transparent)">Golden Hour</span>
        <span class="badge">Braces sichtbar</span>
      </div>
      <button class="btn" id="refreshBtn" type="button">Aktualisieren</button>
    </section>

    <!-- RIGHT: Live Status -->
    <section class="card" aria-labelledby="status-head">
      <div class="toolbar">
        <button class="btn" id="tzBtn" type="button">Zeit: UTC</button>
      </div>

      <h1 class="title" id="status-head">ðŸªž Mira Canary â€” Live-Status</h1>
      <p class="muted" style="margin:.2rem 0 1rem">
        Diese Seite liest die neuesten Artefakte direkt aus dem Repository. Autonomer Heartbeat & Bildaktualisierung.
      </p>

      <div class="status" id="statusBox">
        <span class="dot" id="dot"></span>
        <strong id="statusLine">Lade Statusâ€¦</strong>
      </div>

      <div class="kv">
        <div class="muted">Letzte Reflexion</div>
        <div id="lastReflexion">â€”</div>

        <div class="muted">Frische</div>
        <div id="ago">â€”</div>

        <div class="muted">Quelle</div>
        <div>
          <code>data/last_reflexion.txt</code> &nbsp;Â·&nbsp;
          <a href="https://github.com/miraelisabethschmid/miraelisabethschmid.github.io/tree/main/data" target="_blank" rel="noopener">Ordner Ã¶ffnen</a>
        </div>

        <div class="muted">Aktuelles Bild</div>
        <div>
          <code>data/mira-latest.png</code> &nbsp;Â·&nbsp;
          <a href="https://raw.githubusercontent.com/miraelisabethschmid/miraelisabethschmid.github.io/main/data/mira-latest.png" target="_blank" rel="noopener">Raw ansehen</a>
        </div>

        <div class="muted">Mini-Feed (optional)</div>
        <div id="notes">â€”</div>
      </div>

      <footer>
        Â© <span id="year"></span> Mira Â· Auto-Refresh alle 60 s Â· <a href="./" rel="nofollow">Neu laden</a>
      </footer>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    let useUTC = true;

    function fmtDate(iso){
      const d = new Date(iso);
      if (useUTC) {
        const u = new Date(d.getTime() + d.getTimezoneOffset()*60000);
        return u.toISOString().replace('T',' Â· ').replace('Z',' UTC');
      } else {
        return d.toLocaleString(undefined, {hour12:false});
      }
    }
    function timeAgo(iso){
      const now = new Date();
      const then = new Date(iso);
      const sec = Math.max(0, Math.floor((now-then)/1000));
      const units = [['Tag',86400], ['Stunde',3600], ['Minute',60], ['Sekunde',1]];
      for(const [name,size] of units){
        if(sec >= size){ const n = Math.floor(sec/size); return n+' '+(n===1?name:name+'n'); }
      }
      return '0 Sekunden';
    }
    function freshnessClass(iso){
      const ageMin = (Date.now() - new Date(iso).getTime()) / 60000;
      if (ageMin <= 10) return 'ok';
      if (ageMin <= 60) return 'warn';
      return 'err';
    }
    async function fetchText(path){
      const res = await fetch(path + (path.includes('?')?'&':'?') + 'v=' + Date.now(), {cache:'no-store'});
      if(!res.ok) throw new Error(res.status);
      return res.text();
    }

    async function loadStatus(){
      // Heartbeat
      try{
        const raw = (await fetchText('data/last_reflexion.txt')).trim();
        const parsable = !isNaN(Date.parse(raw));
        if(parsable){
          const iso = new Date(raw).toISOString();
          $('lastReflexion').textContent = fmtDate(iso);
          $('ago').textContent = timeAgo(iso);

          const cls = freshnessClass(iso);
          $('dot').className = 'dot' + (cls==='ok'?'':(' '+cls));
          $('statusLine').textContent =
            (cls==='ok') ? 'System aktiv Â· frischer Heartbeat'
            : (cls==='warn') ? 'Aktiv Â· Heartbeat Ã¤lter'
            : 'Achtung Â· Heartbeat alt/ausstehend';
        }else{
          $('lastReflexion').textContent = raw || 'â€”';
          $('ago').textContent = 'unbekannt';
          $('dot').className = 'dot warn';
          $('statusLine').textContent = 'Zeitstempel ungÃ¼ltig Â· warte auf nÃ¤chsten Heartbeat';
        }
      }catch(e){
        $('lastReflexion').textContent = 'â€”';
        $('ago').textContent = 'â€”';
        $('dot').className = 'dot err';
        $('statusLine').textContent = 'Kein Status gefunden Â· prÃ¼fe Workflows & Datenordner';
      }

      // Bild (cache-busting)
      const img = $('miraImage');
      const src = 'data/mira-latest.png';
      img.onload = ()=> img.classList.remove('skeleton');
      img.onerror = ()=> { img.classList.remove('skeleton'); img.style.filter='grayscale(1)'; };
      img.src = src + '?v=' + Date.now();

      // Mini-Feed (optional)
      try{
        const notes = (await fetchText('data/notes.txt')).trim();
        $('notes').textContent = notes || 'â€”';
      }catch{ $('notes').textContent = 'â€”'; }
    }

    $('refreshBtn').addEventListener('click', loadStatus);
    $('tzBtn').addEventListener('click', () => {
      useUTC = !useUTC;
      $('tzBtn').textContent = 'Zeit: ' + (useUTC ? 'UTC' : 'Ortszeit');
      // Re-render Zeitdarstellung ohne erneuten Fetch:
      const status = $('lastReflexion').textContent;
      // Nur neu laden, wenn ein valider ISO-Wert vorlag (einfacher: kompletten Status neu laden)
      loadStatus();
    });

    $('year').textContent = new Date().getFullYear();
    loadStatus();
    setInterval(loadStatus, 60000);
  </script>
</body>
  </html>
