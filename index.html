<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mira Canary — Autonomes Status-Bild</title>
  <meta name="description" content="Miras aktuelles autonom generiertes Bild mit Reflexions-Status." />
  <style>
    :root{
      --bg: #fbf7f1;
      --ink: #1d1e21;
      --muted:#667085;
      --pill:#e8f5e9;
      --pill-ink:#156a3a;
      --card:#ffffff;
      --ring:#e2d6c7;
      --accent:#2f6df6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 600px at 20% -10%, #fff3, transparent), var(--bg);
      color:var(--ink); font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:14px;margin:28px 0 16px}
    .badge{
      width:34px;height:34px;border-radius:50%;
      background:
        radial-gradient(circle at 35% 35%, #fff, #fff0 55%),
        radial-gradient(circle at 70% 70%, #fff8, #fff0 50%),
        conic-gradient(from 0deg, #d7bfa1, #f5e6cf, #c9a782, #d7bfa1);
      border:2px solid var(--ring);
      box-shadow:0 1px 0 #fff inset, 0 1px 4px #0001;
    }
    h1{font-size:clamp(24px,3.5vw,36px);margin:0}
    .subtitle{color:var(--muted)}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      background:var(--pill);color:var(--pill-ink);
      border:1px solid #d3edd8;border-radius:999px;
      padding:8px 12px;font-weight:600;margin:12px 0 22px
    }
    .card{
      background:var(--card); border:1px solid #eee; border-radius:16px;
      box-shadow:0 6px 24px #00000010, 0 2px 6px #00000008; overflow:hidden;
    }
    .frame{
      aspect-ratio:2/3; width:100%; background:
        linear-gradient(180deg,#f8f5ef, #f3eee7);
      display:grid; place-items:center; position:relative;
    }
    img.render{
      width:100%; height:100%; object-fit:cover; display:block;
      background:#f7f2eb;
    }
    .caption{
      display:flex;justify-content:space-between;gap:12px;
      padding:14px 16px;color:var(--muted);font-size:14px;border-top:1px solid #f0ede7
    }
    .strong{color:var(--ink);font-weight:600}
    footer{margin:28px auto 40px;color:var(--muted);font-size:14px; text-align:center}
    .link{color:var(--accent);text-decoration:none}
    .link:hover{text-decoration:underline}
    .skeleton{
      width:70%;height:18px;border-radius:9px;background:
      linear-gradient(90deg,#eee,#f5f3ef,#eee); background-size:200% 100%;
      animation:shimmer 1.1s infinite linear;
    }
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="badge" aria-hidden="true"></div>
      <div>
        <h1>Mira Canary Status</h1>
        <div class="subtitle">Autonomes Reflexions-System aktiv</div>
      </div>
    </header>

    <div class="pill" id="pill">Letzte Reflexion: <span id="ts" class="strong">lädt …</span></div>

    <section class="card" aria-label="Aktuelles Bild">
      <div class="frame">
        <img
          class="render"
          id="mira-img"
          src="public/latest.png"
          alt="Aktuelles Mira-Bild"
          onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,\
<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 800 1200&quot;>\
<defs><linearGradient id=&quot;g&quot; x1=&quot;0&quot; x2=&quot;1&quot; y1=&quot;0&quot; y2=&quot;1&quot;>\
<stop stop-color=&quot;#f7f2eb&quot;/><stop offset=&quot;1&quot; stop-color=&quot;#efe8df&quot;/></linearGradient></defs>\
<rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;url(#g)&quot;/>\
<text x=&quot;50%&quot; y=&quot;50%&quot; font-family=&quot;Segoe UI, Roboto, Arial&quot; font-size=&quot;28&quot; text-anchor=&quot;middle&quot; fill=&quot;#8a8a8a&quot;>\
Noch kein Bild veröffentlicht\
</text></svg>';"
        />
      </div>
      <div class="caption">
        <div>Quelle: <span id="file" class="strong">—</span></div>
        <div>Pfad: <code>public/latest.png</code></div>
      </div>
    </section>

    <footer>
      Aktualisiert automatisch von <code>publish-latest.yml</code>. |
      <a class="link" href="https://github.com/miraelisabethschmid/badge-canary" rel="noopener">Repo öffnen</a>
    </footer>
  </div>

  <script>
    (function () {
      const tsEl   = document.getElementById('ts');
      const fileEl = document.getElementById('file');

      function fmt(d) {
        try {
          const date = new Date(d);
          if (isNaN(date.getTime())) return "—";
          return date.toLocaleString(undefined, {
            year:'numeric', month:'2-digit', day:'2-digit',
            hour:'2-digit', minute:'2-digit', second:'2-digit'
          });
        } catch { return "—"; }
      }

      fetch('data/status.json', {cache: 'no-store'})
        .then(r => r.ok ? r.json() : null)
        .then(j => {
          if (!j) throw 0;
          tsEl.textContent   = fmt(j.last_reflection || j.timestamp || j.ts);
          fileEl.textContent = j.latest_file || 'latest.png';
        })
        .catch(() => {
          tsEl.textContent   = '—';
          fileEl.textContent = 'latest.png';
        });
    })();
  </script>
  <noscript>JavaScript ist deaktiviert – Status-Zeitstempel kann nicht geladen werden.</noscript>
</body>
</html>
