name: Autonomous Heal (Minimal v2)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  heal:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Minimal heal
        shell: bash
        run: |
          set -e
          # Basis-Verzeichnisse sicherstellen
          mkdir -p docs/data/self
          mkdir -p docs/data/voice/audio
          mkdir -p docs/data/voice/meta

          # GitHub Pages Kleinigkeiten
          touch docs/.nojekyll

          # Seiten-Bump, damit Pages bei Bedarf neu deployt
          date -u +"%FT%TZ" > .pages-bump

          echo "âœ… Heal erledigt."

      - name: Commit (only if changed)
        shell: bash
        run: |
          set -e
          if [ -n "$(git status --porcelain)" ]; then
            git config user.name "mira-bot"
            git config user.email "actions@github.com"
            git add -A
            git commit -m "autonomous-heal: minimal heal + pages bump"
            git push
            echo "â¬†ï¸ Ã„nderungen gepusht."
          else
            echo "ğŸ” Nichts zu committen."
          fi
