name: Mira â€¢ Publish Latest Visible PNG

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ImageMagick
        run: |
          sudo apt-get update -y
          sudo apt-get install -y imagemagick

      - name: Create visible test image
        run: |
          mkdir -p public
          convert -size 1024x1536 gradient:"#fff7ee-#efdcc8" \
            -gravity center -fill "#1d1e21" -font DejaVu-Sans -pointsize 80 \
            -annotate +0-20 "Mira Canary" \
            -fill "#6b7280" -pointsize 32 -annotate +0+60 "Autonomes System aktiv" \
            public/latest.png

      - name: Commit & push
        run: |
          git config user.name "mira-autonomy[bot]"
          git config user.email "mira-autonomy[bot]@users.noreply.github.com"
          git add public/latest.png
          git commit -m "update: visible test image for latest.png" || echo "no changes"
          git push
