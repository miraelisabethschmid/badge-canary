name: Sync self assets to gh-pages

on:
  # Manuell im Actions-Tab startbar
  workflow_dispatch:

  # Automatisch, wenn sich Assets im main-Branch ändern
  push:
    branches:
      - main
    paths:
      - 'data/self/latest_image.png'
      - 'data/self/latest_video.mp4'
      - 'audio/latest.wav'

permissions:
  contents: write

jobs:
  sync-assets:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main
          path: main

      - name: Checkout gh-pages
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          path: ghp

      - name: Copy assets
        run: |
          mkdir -p ghp/data/self
          mkdir -p ghp/audio

          # Bild
          if [ -f main/data/self/latest_image.png ]; then
            cp main/data/self/latest_image.png ghp/data/self/latest_image.png
            echo "Bild kopiert."
          else
            echo "Kein data/self/latest_image.png gefunden – übersprungen."
          fi

          # Video
          if [ -f main/data/self/latest_video.mp4 ]; then
            cp main/data/self/latest_video.mp4 ghp/data/self/latest_video.mp4
            echo "Video kopiert."
          else
            echo "Kein data/self/latest_video.mp4 gefunden – übersprungen."
          fi

          # Audio (optional, bricht NIE ab)
          if [ -f main/audio/latest.wav ]; then
            cp main/audio/latest.wav ghp/audio/latest.wav
            echo "Audio kopiert."
          else
            echo "Kein audio/latest.wav gefunden – Audio wird übersprungen."
          fi

      - name: Commit and push changes
        working-directory: ghp
        run: |
          if git status --porcelain | grep .; then
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add .
            git commit -m "Sync self assets to gh-pages"
            git push origin gh-pages
            echo "Änderungen nach gh-pages gepusht."
          else
            echo "Keine Änderungen – nichts zu committen."
          fi
