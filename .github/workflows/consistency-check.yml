name: Consistency Check (Minimal v2)

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run lightweight consistency checks
        shell: bash
        run: |
          set -euo pipefail
          SUMMARY="$GITHUB_STEP_SUMMARY"

          echo "## Consistency Check – Ergebnis" > "$SUMMARY"
          echo "" >> "$SUMMARY"

          warn() { echo "⚠️  $*"; echo "- ⚠️ $*" >> "$SUMMARY"; }
          ok()   { echo "✅ $*"; echo "- ✅ $*" >> "$SUMMARY"; }

          # Basis-Verzeichnisse
          for d in docs docs/data docs/data/self docs/data/voice docs/data/voice/audio; do
            if [[ -d "$d" ]]; then ok "Ordner vorhanden: $d"; else warn "Ordner fehlt: $d"; fi
          done

          # Startseite
          if [[ -f docs/index.html ]]; then
            ok "Startseite vorhanden: docs/index.html"
          else
            warn "Startseite fehlt: docs/index.html"
          fi

          # Platzhalter-Bild (optional)
          if compgen -G "docs/data/self/latest_image.*" > /dev/null; then
            ls -lh docs/data/self/latest_image.* | tee -a "$SUMMARY" || true
            ok "Self-Image vorhanden (latest_image.*)"
          else
            warn "Kein Self-Image (latest_image.*) gefunden – Platzhalter wird angezeigt."
          fi

          # Voice (optional)
          if compgen -G "docs/data/voice/audio/latest.*" > /dev/null; then
            ls -lh docs/data/voice/audio/latest.* | tee -a "$SUMMARY" || true
            ok "Voice-Datei vorhanden (latest.*)"
          else
            warn "Keine Voice-Datei gefunden (docs/data/voice/audio/latest.*)."
          fi

          echo "" >> "$SUMMARY"
          echo "_Hinweis: Dieser Check ist **informativ** und schlägt nicht fehl._" >> "$SUMMARY"

      # Wichtig: niemals failen – immer grün
      - name: Finalize
        run: echo "Done."
