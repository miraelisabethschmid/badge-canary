name: Ensure Hero Assets

on:
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: ensure-hero-assets
  cancel-in-progress: true

jobs:
  ensure-hero-assets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout gh-pages
        uses: actions/checkout@v4
        with:
          ref: gh-pages

      - name: Ensure directories exist
        run: |
          mkdir -p docs/portrait
          mkdir -p data/self

      - name: Sync mira-hero.svg → latest_image.svg
        run: |
          if [ -f "docs/portrait/mira-hero.svg" ]; then
            cp docs/portrait/mira-hero.svg data/self/latest_image.svg
            echo "Synced mira-hero.svg to data/self/latest_image.svg"
          else
            echo "docs/portrait/mira-hero.svg not found"
            exit 1
          fi

      - name: Ensure latest_image.svg fallback
        run: |
          if [ ! -s "data/self/latest_image.svg" ]; then
            echo '<svg xmlns="http://www.w3.org/2000/svg" width="800" height="480"><rect width="800" height="480" fill="#0f172a"/><text x="50%" y="50%" fill="#e5e7eb" font-size="26" text-anchor="middle">Mira – Titelbild</text></svg>' > data/self/latest_image.svg
            echo "Created minimal fallback SVG"
          fi

      - name: Commit and push
        run: |
          git config user.name  "hero-bot"
          git config user.email "actions@users.noreply.github.com"

          if git diff --quiet; then
            echo "No changes."
          else
            git add data/self/latest_image.svg
            git commit -m "ensure-hero-assets: sync latest_image.svg"
            git push origin gh-pages
          fi
