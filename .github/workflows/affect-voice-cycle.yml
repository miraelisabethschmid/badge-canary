name: Affect Voice Cycle (Minimal v2)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  cycle:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure voice folders + status
        shell: bash
        run: |
          set -e
          mkdir -p docs/data/voice/audio
          mkdir -p docs/data/voice/meta
          echo "cycle_ts=$(date -u +%FT%TZ)" > docs/data/voice/meta/last_cycle.env
          printf "%s\n" "Affect voice cycle OK" > docs/data/voice/meta/status.txt
          echo "‚úÖ Voice-Cycle aktualisiert."

      - name: Commit (only if changed)
        shell: bash
        run: |
          set -e
          if [ -n "$(git status --porcelain)" ]; then
            git config user.name "mira-bot"
            git config user.email "actions@github.com"
            git add -A
            git commit -m "affect-voice-cycle: refresh meta"
            git push
            echo "‚¨ÜÔ∏è √Ñnderungen gepusht."
          else
            echo "üîç Nichts zu committen."
          fi
