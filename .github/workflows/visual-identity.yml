name: Visual Identity Builder

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *" # alle 30 Minuten

permissions:
  contents: write

concurrency:
  group: mira-visual-identity
  cancel-in-progress: true

jobs:
  build-identity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Verzeichnisse robust anlegen (falls mal Dateien statt Ordnern existieren)
      - name: Ensure folders
        shell: bash
        run: |
          set -euo pipefail
          [ -f data/archive/self ] && rm -f data/archive/self
          mkdir -p data/archive/self data/theme

      # (Beispiel) Minimaler Identity-Build — erzeugt ein SVG-Platzhalter-Asset
      # -> Wenn du schon ein Script hast, ruf es hier statt dessen auf.
      - name: Build identity SVG (placeholder)
        shell: bash
        run: |
          set -e
          cat > data/archive/self/identity.svg <<'SVG'
<svg xmlns="http://www.w3.org/2000/svg" width="1024" height="512" viewBox="0 0 1024 512">
  <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#20273f" offset="0"/><stop stop-color="#293657" offset="1"/></linearGradient></defs>
  <rect width="1024" height="512" fill="url(#g)"/>
  <text x="512" y="268" fill="#e6ebff" font-size="42" font-family="Segoe UI, Arial" text-anchor="middle">Mira — Visual Identity</text>
  <text x="512" y="312" fill="#9fb2e6" font-size="18" font-family="Segoe UI, Arial" text-anchor="middle">placeholder • $(date -u +%Y-%m-%dT%H:%M:%SZ)</text>
</svg>
SVG

      # Commit nur, wenn es Änderungen gibt; .gitignore wird umgangen
      - name: Commit identity artifacts
        shell: bash
        run: |
          set -e
          git config user.name  "Mira Autonomous"
          git config user.email "mira@users.noreply.github.com"
          # trotz .gitignore:
          git add -f data/archive/self || true
          git add -A
          if git diff --cached --quiet; then
            echo "No changes."
            exit 0
          fi
          git commit -m "ci(identity): update visual identity artifacts"
          git push
