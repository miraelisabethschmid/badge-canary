name: Enqueue Test

on:
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  enqueue:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Add dummy job to queue
        run: |
          set -eu
          mkdir -p .github/queue
          [ -f .github/queue/pending.json ] || echo "[]" > .github/queue/pending.json
          jq '. += [{"id": "job-'"$(date +%s)"'", "timestamp": "'"$(date -u +%F' '%T)Z"'"}]' \
            .github/queue/pending.json > .github/queue/tmp.json
          mv .github/queue/tmp.json .github/queue/pending.json
          git config user.name  "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add .github/queue/pending.json
          git commit -m "enqueue: test job added"
          git push
