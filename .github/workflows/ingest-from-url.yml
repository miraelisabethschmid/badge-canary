name: Mira Â· Ingest Portrait from URL

on:
  workflow_dispatch:
    inputs:
      image_url:
        description: "Direct image URL (must end with .png or .jpg)"
        required: true
      out_path:
        description: "Target path in repo"
        required: false
        default: "public/latest.png"

jobs:
  ingest:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Prepare folders
        run: |
          mkdir -p public

      - name: Download & verify image
        id: dl
        env:
          IMAGE_URL: ${{ github.event.inputs.image_url }}
        run: |
          set -euo pipefail
          curl -LfsS "$IMAGE_URL" -o /tmp/in.png
          file -b --mime-type /tmp/in.png | grep -E '^image/(png|jpeg)$' >/dev/null

      - name: Publish to target path
        env:
          OUT: ${{ github.event.inputs.out_path }}
        run: |
          cp /tmp/in.png "$OUT"

      - name: Commit & push
        run: |
          git config user.name  "mira-autonomy[bot]"
          git config user.email "mira-autonomy@users.noreply.github.com"
          git add -A
          git commit -m "Publish latest portrait from URL" || echo "nothing to commit"
          git push
