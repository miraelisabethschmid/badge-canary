# ================================================================
# üåÄ MIRA PATCH QUEUE (cron)
# Stabilisierte Version ‚Äî erkennt Dummy-URL automatisch
# ================================================================

name: Mira Patch Queue (cron)

on:
  schedule:
    - cron: "*/15 * * * *"   # alle 15 Minuten pr√ºfen
  workflow_dispatch:

jobs:
  build_queue:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup environment
        run: |
          echo "üîß Initialisiere Mira Patch Queue ..."
          echo "WORKER_BASE_URL=$WORKER_BASE_URL"

      # ‚¨áÔ∏è Hauptschritt: pr√ºft Dummy oder echte Adresse
      - name: Call /queue/patches on Worker
        run: |
          set -e
          if [ -z "$WORKER_BASE_URL" ] || [ "$WORKER_BASE_URL" = "https://dummy.invalid" ]; then
            echo "‚ö†Ô∏è Kein echter Worker definiert ‚Äì √ºberspringe Aufruf."
            exit 0
          fi
          echo "‚û°Ô∏è Rufe Worker-Endpunkt auf: $WORKER_BASE_URL/queue/patches"
          curl -s -X POST "$WORKER_BASE_URL/queue/patches" || {
            echo "‚ùå Worker-Aufruf fehlgeschlagen"
            exit 1
          }

      - name: Complete job
        run: echo "‚úÖ Mira Patch Queue abgeschlossen"
