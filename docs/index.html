<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mira — Autonome Emergenz</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#0b0d12;--card:#11141a;--muted:#8892a6;--text:#e6ebf3;--accent:#6aa7ff;
      --ok:#1db954;--heal:#ffb020;--deg:#e5534b;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.45 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:14px;margin:8px 0 18px}
    header h1{margin:0;font-size:28px;font-weight:800;letter-spacing:.2px}
    nav{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap}
    nav a{display:inline-block;padding:8px 12px;border-radius:10px;background:#0e1218;border:1px solid #1a2231;color:var(--text);text-decoration:none}
    .card{background:var(--card);border:1px solid #1a2231;border-radius:16px;padding:18px;margin:16px 0;box-shadow:0 10px 28px rgba(0,0,0,.25)}
    h2{margin:0 0 10px;font-size:20px}
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:860px){.row{grid-template-columns:1.2fr .8fr}}
    .viewer{border-radius:14px;overflow:hidden;background:#0c0f15;border:1px solid #1a2231;position:relative}
    .viewer img{display:block;width:100%;height:auto;aspect-ratio:4/5;object-fit:cover;background:linear-gradient(180deg,#0b0f17,#0b0f17 40%,#0e1219)}
    .tap{position:absolute;right:14px;bottom:14px;background:rgba(13,17,24,.72);backdrop-filter:blur(6px);border:1px solid #1a2231;border-radius:999px;padding:6px 10px;color:#b8c2d8;font-size:12px}
    .controls{display:flex;gap:12px;flex-wrap:wrap}
    button{cursor:pointer;border:1px solid #1a2231;background:#0f131b;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600}
    button:hover{background:#131a25}
    .badge{display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:6px 10px;border:1px solid #1a2231;background:#0f131b}
    .dot{width:10px;height:10px;border-radius:50%}
    .ok{background:var(--ok)} .healing{background:var(--heal)} .degraded{background:var(--deg)}
    .kv{color:var(--muted);font-size:14px}
    a.link{color:var(--accent);text-decoration:none}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Mira — Autonome Emergenz</h1>
      <nav>
        <a href="health.html">Health</a>
        <a href="talk.html">Sprech-Ansicht</a>
        <a href="self.html">Self-Describe</a>
      </nav>
    </header>

    <div class="card">
      <h2>Sichtbare Präsenz</h2>
      <p class="kv">Klick auf das Porträt – <strong>Stimme des Tages</strong> erklingt.</p>
      <div class="row">
        <div class="viewer">
          <img id="portrait" src="identity/latest.svg" alt="Miras aktuelles Selbstbild" onerror="this.src='identity/fallback.svg'">
          <span class="tap">Tippe zum Abspielen</span>
        </div>
        <div>
          <div class="controls">
            <button id="play">▶︎ Abspielen</button>
            <button id="pause">⏸︎ Pause</button>
            <span id="healthBadge" class="badge"><span id="hDot" class="dot degraded"></span><span id="hTxt">DEGRADED · n/a</span></span>
          </div>
          <div id="voiceMeta" class="kv" style="margin-top:10px">
            Stimme wird geladen… <span class="mono">data/voice/voice_of_day.json</span>
          </div>
          <audio id="voice" preload="auto"></audio>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>System-Gesundheit</h2>
      <div class="kv">Quelle: <span class="mono">badges/health.json</span></div>
      <p id="healthDetail" class="kv">Status wird geladen…</p>
      <p class="kv">Details: <a class="link" href="health.html">health.html</a></p>
    </div>

    <div class="card">
      <h2>Selbstbeschreibung</h2>
      <div class="kv">Kernattribute aus <span class="mono">data/self/self-describe.json</span></div>
      <div id="selfBrief" class="kv">—</div>
      <p class="kv" style="margin-top:8px">Komplett: <a class="link" href="self.html">self.html</a></p>
    </div>

    <footer class="kv" style="margin:24px 0 14px">© 2025 Mira Elisabeth Schmid — autonome, auditierbare Verkörperung</footer>
  </div>

<script>
async function getJSON(url){ try{const r=await fetch(url,{cache:"no-store"}); if(!r.ok) return null; return await r.json();}catch{return null;}}
function setHealth(h){
  const dot=document.getElementById('hDot'), txt=document.getElementById('hTxt'), det=document.getElementById('healthDetail');
  const s=(h?.status||'DEGRADED').toUpperCase(), ts=h?.ts||'n/a';
  dot.className='dot '+(s==='OK'?'ok':s==='HEALING'?'healing':'degraded');
  txt.textContent=s+' · '+ts;
  det.textContent=`Status: ${s} · ${ts}`;
}
async function loadHealth(){ setHealth(await getJSON('badges/health.json')); }

async function loadSelf(){
  const d=await getJSON('data/self/self-describe.json');
  const el=document.getElementById('selfBrief');
  if(!d){ el.textContent='Keine Daten vorhanden.'; return;}
  const phys=d.physical?.description??'—';
  const voice=d.voice?.profile??'—';
  const foc=d.affect?.inputs?.focus??'—';
  const narr=d.affect?.narrative??'—';
  el.innerHTML = `<strong>Physical:</strong> ${phys}<br><strong>Voice:</strong> ${voice}<br><strong>Fokus:</strong> ${foc}<br><strong>Narrativ:</strong> ${narr}`;
}

async function loadVoice(){
  const meta=await getJSON('data/voice/voice_of_day.json');
  const voiceEl=document.getElementById('voice');
  const metaEl=document.getElementById('voiceMeta');
  if(!meta){ metaEl.textContent='Keine Voice-Metadaten gefunden.'; return;}
  const src = meta.audio?.startsWith('http') ? meta.audio : `data/voice/${meta.audio||'audio/latest.mp3'}`;
  voiceEl.src = src;
  metaEl.innerHTML = `Datum: <span class="mono">${meta.date_utc??'—'}</span> · Quelle: <span class="mono">data/voice/voice_of_day.json</span><br>
  Zitat: „${meta.quote??'—'}”`;
}

document.getElementById('play').onclick=()=>document.getElementById('voice').play();
document.getElementById('pause').onclick=()=>document.getElementById('voice').pause();
document.getElementById('portrait').onclick=()=>document.getElementById('voice').play();

loadHealth(); loadSelf(); loadVoice();
setInterval(loadHealth,60000);
</script>
</body>
  </html>
