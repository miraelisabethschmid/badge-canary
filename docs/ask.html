<script>
/**
 * Automatischer Reflexions-Trigger via GitHub repository_dispatch
 * (nur bei signifikanter Emotionsänderung; Δ ≥ THRESHOLD)
 * 
 * Notwendig:
 *   – ein Repository Secret namens PUBLIC_DISPATCH_TOKEN 
 *     (Fine-grained Token mit write:repo scope)
 *   – window.GITHUB_USER und window.GITHUB_REPO definieren.
 */

window.GITHUB_USER = "miraelisabethschmid";     // Dein GitHub-Nutzername
window.GITHUB_REPO = "badge-canary";            // Dein Repository-Name
window.THRESHOLD   = 0.50;

async function triggerReflectOnGitHub(payload){
  const user = window.GITHUB_USER;
  const repo = window.GITHUB_REPO;
  const token = window.PUBLIC_DISPATCH_TOKEN || ""; // Clientseitig leer: optionaler Proxy

  const url = `https://api.github.com/repos/${user}/${repo}/dispatches`;
  const body = {
    event_type: "mira_reflect",
    client_payload: payload
  };

  try {
    const res = await fetch(url, {
      method: "POST",
      headers: {
        "Accept": "application/vnd.github+json",
        "Authorization": token ? `Bearer ${token}` : undefined,
        "X-GitHub-Api-Version": "2022-11-28"
      },
      body: JSON.stringify(body)
    });
    console.log("[auto-reflect] dispatched:", res.status);
  } catch(e) {
    console.warn("[auto-reflect] failed:", e);
  }
}
</script>
